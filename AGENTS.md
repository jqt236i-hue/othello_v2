# カードオセロ / AGENTS.md

最終更新: 2026-01-27

このファイルは「このリポジトリでの作業の進め方」です（強制ルールはリポジトリ内の指示Markdown側）。

## 併用前提（ブレ防止）

- 人間の作業と補完ツールの作業で判断がズレないよう、**優先順位**と**置き場所**をここで固定する。
- このファイルは「段取り・整理」のための案内。**強制ルールと衝突したら強制ルールを優先**する。

## 指示の優先順位（衝突時は上が勝つ）

1) 仕様（一次情報）: `01-rulebook.md`（末尾の UI/演出仕様も含む）  
2) 強制ルール（運用/境界/禁止事項）: `.github/copilot-instructions.md`  
3) 対象別の追加指示: `.github/instructions/*.instructions.md`（`applyTo` の範囲内のみ）  
4) このファイル（段取り・メモ・作業の癖を揃える）

## 参照（最初に見る）

- 強制ルール: リポジトリ内の指示Markdown（禁止/必須のルール群）
- AI作業ガイド（強制）: `.github/copilot-instructions.md`
- 仕様（一次情報）: `01-rulebook.md`（末尾に UI/演出仕様）
- カード定義: `cards/catalog.json`（ミラー: `cards/catalog.js`）
- 作業レシピ集: `SKILLS.md`

## 重要: ローカル完結の徹底
- 提案はローカル作業だけで完結する内容に限定し、外部へ送信/外部で確認を前提にしない（言い回しも同様）。
- 外部のコード保管先へ変更を送信しない（外部のレビュー作成・統合などを含む）。
- 文書、コミットメッセージ、テスト名、コードコメントなどで外部サービス由来の固有名詞・用語を使わない。

## 段取り（基本）

1) 目的を決める（ルール / UI / 整理）。
2) 影響範囲を列挙する（関連、テスト、自動チェック）。
3) ルール変更なら `01-rulebook.md` → テスト → 実装。
4) 代表例 + 境界条件で確認できる形にする。
5) 差分最小・共通経路再利用（コピペ分岐を増やさない）。

## AI編集を容易にするためのガイド（実行ルール）

### 入口の整理
- 起動順の唯一の入口は `index.html` に集約する。
- 依存順はセクションコメントで固定し、順序変更は必ず理由を残す。

### モジュール境界（依存方向）
- `game/` は `ui/` を直接参照しない（UI依存は DI 経由）。
- `ui/` は `game/` の公開APIのみを使う（内部実装に依存しない）。
- `cpu/` は `game/` の読み取り専用 API を利用し、副作用を持たない。
- 変更の前後で、境界が崩れていないか短く確認する（game/ と ui/ を直接またがない）。

### 依存注入（DI）
- UI実装の注入は `ui/bootstrap.js` に一本化する。
- `__uiImpl_*` の出口は1か所で定義し、ゲーム側はインターフェースのみ知る。

### 定数と設定
- 定数は `constants/` と `shared-constants.js` に集約する。
- 同じ意味の定数を複数ファイルに持たない。

### グローバル状態
- `window` への公開は最小限にし、必ず一覧で管理する。
- 追加する場合は「公開理由」と「参照先」をコメントで明記。

### デバッグ/診断
- 本番動作に影響するデバッグは `?debug=1` 等で明示的に有効化。
- 診断UIは `ui/` 内に隔離し、常時稼働の `setInterval` を避ける。

### ファイル配置（変更時の優先ルール）
- 仕様変更は `01-rulebook.md` → 実装の順。
- UI演出は `ui/animation-*` と `ui/stone-visuals.js` に集約。
- ゲーム効果は `game/card-effects/` と `game/special-effects/` に集約。

### 変更単位
- 1 作業単位 / 1 目的 / 1 系列のファイル群に限定する。
- 削除時は参照検索の結果を残す。

## 完了の目安

- 目的を満たし、関連の挙動が壊れていない。

## 共有メモに書くこと

- 何を変えたか / どの一次情報に基づくか。

## 返信

- 最後に、専門用語を使わない短い説明を付ける。
